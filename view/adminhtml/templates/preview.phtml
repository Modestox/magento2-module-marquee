<?php
/**
 * Copyright Â© 2026 Modestox (https://github.com/modestox). All rights reserved.
 * License: MIT
 */

?>
<div class="modestox-marquee-preview-wrapper" style="margin-bottom: 20px; border: 1px solid #ccc; padding: 10px; background: #fafafa;">
    <label class="admin__field-label"><span><?= __('Live Preview') ?></span></label>

    <div id="mdx-preview-container"
         style="overflow: hidden; white-space: nowrap; background: #333; color: #fff; height: 40px; line-height: 40px; margin-top: 10px;">
        <div id="mdx-preview-text" style="display: inline-block; padding-left: 100%; animation: mdx-marquee 20s linear infinite;">
            <span>Preview Text</span>
        </div>
    </div>
</div>

<style>
    @keyframes mdx-marquee {
        0% {
            transform: translateX(0);
        }
        100% {
            transform: translateX(-100%);
        }
    }
</style>

<script>
    require(['jquery', 'uiRegistry'], function ($, registry) {
        'use strict';

        var fields = {
            content: 'modestox_marquee_form.modestox_marquee_form.general.content',
            bg: 'modestox_marquee_form.modestox_marquee_form.general.bg_color',
            text: 'modestox_marquee_form.modestox_marquee_form.general.text_color'
        };

        function updatePreview(type, value) {
            var $cont = $('#mdx-preview-container');
            var $text = $('#mdx-preview-text span');

            if (type === 'content') $text.text(value || 'Preview Text');
            if (type === 'bg') $cont.css('background-color', value);
            if (type === 'text') $cont.css('color', value);
        }

        Object.keys(fields).forEach(function (key) {
            registry.get(fields[key], function (field) {
                updatePreview(key, field.value());
                field.value.subscribe(function (newValue) {
                    updatePreview(key, newValue);
                });
            });
        });
    });
</script>
